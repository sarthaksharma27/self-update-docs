datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum RepositoryType {
  MAIN
  DOCS
  IGNORE
}

enum IndexingStatus {
  IDLE          // Default state, nothing started
  DOWNLOADING   // Files are being fetched from GitHub to local disk
  DOWNLOADED    // Files are fully written to disk
  INDEXING      // CocoIndex docker container is processing the files
  COMPLETED     // Indexing finished successfully
  FAILED        // Something went wrong in the pipeline
}

model InstallationOwner {
  id                   String       @id @default(uuid())
  githubInstallationId Int          @unique
  githubLogin          String       @unique
  githubAccountType    String       

  isActive              Boolean  @default(true)
  uninstalledAt         DateTime?

  repositories         Repository[] 

  createdAt            DateTime     @default(now())
}

model Repository {
  id                  String             @id @default(uuid())
  owner               String
  name                String
  
  type                RepositoryType     @default(MAIN)
  
  // NEW: Tracking the indexing lifecycle
  indexingStatus      IndexingStatus     @default(IDLE)
  lastIndexedAt       DateTime?
  errorMessage        String?            // To store why a failure happened

  installationOwnerId String
  installationOwner   InstallationOwner  @relation(fields: [installationOwnerId], references: [id])

  createdAt           DateTime           @default(now())

  @@index([type])
  @@index([indexingStatus]) // Senior move: Indexing the status for fast dashboard filtering
}