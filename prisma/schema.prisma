datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum RepositoryType {
  MAIN
  DOCS
  IGNORE
  HYBRID
}

enum IndexingStatus {
  IDLE          
  DOWNLOADING   
  DOWNLOADED    
  INDEXING      
  COMPLETED     
  FAILED        
}

model InstallationOwner {
  id                   String       @id @default(uuid())
  githubInstallationId Int          @unique
  githubLogin          String       @unique
  githubAccountType    String       

  isActive              Boolean  @default(true)
  uninstalledAt         DateTime?

  repositories         Repository[] 

  createdAt            DateTime     @default(now())
}

model Repository {
  id                  String             @id @default(uuid())
  owner               String
  name                String
  
  type                RepositoryType     @default(IGNORE)
  
  indexingStatus      IndexingStatus     @default(IDLE)
  lastIndexedAt       DateTime?
  errorMessage        String?            

  installationOwnerId String
  installationOwner   InstallationOwner  @relation(fields: [installationOwnerId], references: [id])

  createdAt           DateTime           @default(now())

  @@index([type])
  @@index([indexingStatus]) // Senior move: Indexing the status for fast dashboard filtering
}